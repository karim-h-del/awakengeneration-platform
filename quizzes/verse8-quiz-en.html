<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz ‚Äì Verse 8</title>
  <link rel="stylesheet" href="/assets/css/quiz-style.css" />
</head>
<body>
  <header>
    <h1>üß™ Reflection Quiz ‚Äì Verse 8</h1>
    <p>Test your understanding of knowledge as nearness to God.</p>
  </header>

  <div id="quiz-container"></div>

  <!-- Feedback + Submit -->
  <div id="quiz-form" class="quiz-container">
    <div id="quiz-feedback"></div>
    <button id="submit-answers">Submit Answers</button>
  </div>

  <footer>
    <p><a href="/index.html">‚Üê Back to Manifesto</a></p>
  </footer>

  <script type="module">
  import { quizData, checkAnswer } from '/assets/js/quiz.js';

  // Filter only Verse 8 English questions
  const container = document.getElementById("quiz-container");
  const filtered = quizData.filter(q => q.id.startsWith("verse8-en"));

  // Render questions
  filtered.forEach((q, i) => {
    const qDiv = document.createElement("div");
    qDiv.className = "quiz-question unanswered";
    qDiv.dataset.index = i;

    const qText = document.createElement("div");
    qText.className = "quiz-question-text";
    qText.textContent = `${i + 1}. ${q.question}`;
    qDiv.appendChild(qText);

    const optionsDiv = document.createElement("div");
    optionsDiv.className = "quiz-options";

    q.options.forEach((opt, idx) => {
      const label = document.createElement("label");
      label.className = "quiz-option";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${i}`;
      input.value = idx;

      // Mark question as answered when any option chosen
      input.addEventListener("change", () => {
        qDiv.classList.remove("unanswered");
      });

      label.appendChild(input);
      label.appendChild(document.createTextNode(opt));
      optionsDiv.appendChild(label);
    });

    qDiv.appendChild(optionsDiv);
    container.appendChild(qDiv);
  });

  // Submit handling
  const submitBtn = document.getElementById("submit-answers");
  const feedbackBox = document.getElementById("quiz-feedback");

  submitBtn.addEventListener("click", () => {
    let score = 0;

    document.querySelectorAll(".quiz-question").forEach((qDiv, i) => {
      const selected = document.querySelector(`input[name="q${i}"]:checked`);
      const correctIndex = filtered[i].answer;

      // Clear previous state classes
      qDiv.classList.remove("correct", "wrong", "unanswered");

      if (!selected) {
        qDiv.classList.add("unanswered");
      } else if (checkAnswer(filtered.findIndex(q => q.id === filtered[i].id), Number(selected.value))) {
        qDiv.classList.add("correct");
        score += 1;
      } else {
        qDiv.classList.add("wrong");
      }

      // Add or update explanation
      let expl = qDiv.querySelector(".quiz-explanation");
      if (!expl) {
        expl = document.createElement("div");
        expl.className = "quiz-explanation";
        qDiv.appendChild(expl);
      }
      expl.textContent = filtered[i].explanation;
    });

    const total = filtered.length;
    feedbackBox.textContent = `Your score: ${score} / ${total}`;
    try {
      localStorage.setItem("score_verse8-quiz-en", `${score}/${total}`);
    } catch(e) {
      // ignore storage errors
    }
  });
</script>
</body>
</html>